#!/bin/bash -e
#
# ==============================================================================
# PAQUETE: canaima-estilo-visual-gnome
# ARCHIVO: preinst
# DESCRIPCIÓN: Configura el sistema antes de la instalación del paquete.
# COPYRIGHT:
#  (C) 2010 Randy Ortega <ortega571@gmail.com>
# LICENCIA: GPL3
# ==============================================================================
#
# Este programa es software libre. Puede redistribuirlo y/o modificarlo bajo los
# términos de la Licencia Pública General de GNU (versión 3).

PKG="canaima-estilo-visual-gnome"

case ${1} in

	install|upgrade)

		if [ "$2" < 3.1 ]; then

			# Para cada usuario en /home/ ...
			for HOME_U in /home/*?; do

				# Obteniendo sólo el nombre del usuario
				USUARIO=$( basename ${HOME_U} )

				# Y en caso de que el usuario sea un usuario activo (existente en /etc/shadow) ...
				if [ $( grep -c "${USUARIO}:.*:.*:.*:.*:.*:::" /etc/shadow ) == 1 ] \
				&& [ $( grep -c "${USUARIO}:.*:.*:.*:.*:.*:/bin/.*sh" /etc/passwd ) == 1 ] \
				&& [ -d ${HOME_U}/.config ] \
				&& [ -d ${HOME_U} ]; then
					rm -rf ${HOME_U}/.gconf
				fi
			done
		fi
	;;

	abort-upgrade)
	;;

	*)
		ERROR "preinst no reconoce el argumento '"${1}"'" >&2
		exit 1
	;;

esac

#DEBHELPER#

exit 0
