#!/bin/bash -e
#
# ==============================================================================
# PAQUETE: canaima-estilo-visual
# ARCHIVO: postinst
# DESCRIPCIÓN: Configura el sistema despues la instalación del paquete.
# COPYRIGHT:
#  (C) 2010 Luis Alejandro Martínez Faneyth <martinez.faneyth@gmail.com>
#  (C) 2010 Diego Alberto Aguilera Zambrano <daguilera85@gmail.com>
#  (C) 2010 Carlos Alejandro Guerrero Mora <guerrerocarlos@gmail.com>
#  (C) 2010 Francisco Javier Vásquez Guerrero <franjvasquezg@gmail.com>
# LICENCIA: GPL3
# ==============================================================================
#
# Este programa es software libre. Puede redistribuirlo y/o modificarlo bajo los
# términos de la Licencia Pública General de GNU (versión 3).

PKG="canaima-estilo-visual"
# Color Verde
VERDE="\e[1;32m"
# Color Rojo
ROJO="\e[1;31m"
# Color Amarillo
AMARILLO="\e[1;33m"
# Negrita
BOLD="\e[1m"
# Caracter de fin de línea
FIN="\e[0m"

function ERROR() {
echo -e ${ROJO}${1}${FIN}
exit 1
}

function ADVERTENCIA() {
echo -e ${AMARILLO}${1}${FIN}
}

function EXITO() {
echo -e ${VERDE}${1}${FIN}
}

case ${1} in

	configure)

	ADVERTENCIA "Migrando Grub a Burg ..."

	[ ! -e /usr/sbin/update-burg ] && echo "#!/bin/bash" > /usr/sbin/update-burg
	chmod +x /usr/sbin/update-burg

	if [ -e /usr/sbin/update-grub ]; then
		mv /usr/sbin/update-grub /usr/sbin/update-grub.backup
		ln -s /usr/sbin/update-burg /usr/sbin/update-grub
	fi

	if [ -e /usr/sbin/update-grub2 ]; then
		mv /usr/sbin/update-grub2 /usr/sbin/update-grub2.backup
		ln -s /usr/sbin/update-burg /usr/sbin/update-grub2
	fi

	if [ $( cat /etc/kernel-img.conf | grep "postinst_hook = update-burg" | wc -l ) == 0 ];	then
		echo "postinst_hook = update-burg" >> /etc/kernel-img.conf
		echo "postrm_hook = update-burg" >> /etc/kernel-img.conf
	fi

	if [ -e /etc/default/burg ]; then
		sed -i 's/GRUB_GFXMODE=.*/GRUB_GFXMODE=1024x768/g' /etc/default/burg
		sed -i 's/GRUB_THEME=.*/GRUB_THEME=radiancetext/g' /etc/default/burg
		sed -i 's/GRUB_TIMEOUT=.*/GRUB_TIMEOUT=3/g' /etc/default/burg
		sed -i 's/GRUB_DISTRIBUTOR=.*/GRUB_DISTRIBUTOR="Canaima"/g' /etc/default/burg
		sed -i 's/GRUB_CMDLINE_LINUX_DEFAULT=.*/GRUB_CMDLINE_LINUX_DEFAULT="quiet splash vga=791"/g' /etc/default/burg
		sed -i 's/GRUB_CMDLINE_LINUX=.*/GRUB_CMDLINE_LINUX=""/g' /etc/default/burg
	fi
	if [ -e /etc/burg.d/10_linux ]; then
		sed -i 's/%s, with Linux %s (recovery mode)/%s (Restaurar)/g' /etc/burg.d/10_linux
		sed -i 's/%s, with Linux %s/%s/g' /etc/burg.d/10_linux
                sed -i 's/"${os}" //g' /etc/burg.d/10_linux
	fi


	if [ -e /etc/gdm3/greeter.gconf-defaults ]; then
		sed -i 's/\/apps\/gdm\/simple-greeter\/logo_icon_name.*/\/apps\/gdm\/simple-greeter\/logo_icon_name\t\tstart-here/g' /etc/gdm3/greeter.gconf-defaults
	fi

	;;

	abort-upgrade|abort-remove|abort-deconfigure)
	;;

	*)

		ERROR "postinst no reconoce el argumento '"${1}"'" >&2
		exit 1

	;;

esac

#DEBHELPER#

exit 0
